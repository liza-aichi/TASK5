<?php

/***
 * implements hook_menu
 * @return array
 */
function address_book_menu()
{
    return array(


        'admin/structure/contacts' => array(
            'title' => 'Contact',

            'type' => MENU_NORMAL_ITEM,

            'page callback' => 'address_book_manage_page',

            'access callback' => 'user_access',

            'access arguments' => array('administer site configuration'), //'administer site configuration',// 'user_access',


        ),
        'address-book/addcontact' => array(
            'title' => 'Add',

            'type' => MENU_LOCAL_TASK, //MENU_CALLBACK,

            'page callback' => 'address_book_add',

            'access callback' => TRUE, //'administer site configuration',// 'user_access',

            'file' => 'address_book.admin.inc'
        ),
    );
}

/***
 * go to add contact form
 */
function address_book_add()
{
    drupal_goto('address-book/add');
}

/***
 * implements hook_entity_info
 * @return array
 */
function address_book_entity_info()
{
    return array(
        'contact' => array(
            'label' => t('Contact'),
            'base table' => 'contact',
            'label callback' => 'address_book_title_callback',
            'fieldable' => TRUE,
            'entity keys' => array(
                'id' => 'cid',
                'label' => 'title',
//        'bundle' => 'type',
            ),
            'bundles' => array(
                'contact' => array(
                    'label' => t('Contact'),
                    'admin' => array(
                        'path' => 'admin/structure/contacts',
                        //  'access callback' =>TRUE,
                        'access callback' => 'user_access',
                        // 'access arguments' =>array('view content'),
                        'access arguments' => array('administer site configuration'),
                    ),
                ),
            ),

// Entity API-related parameters.
            'controller class' => 'EntityAPIController',
            'entity class' => 'Entity',
            'admin ui' => array(
                'path' => 'address-book',
                'file' => 'address_book.admin.inc',
            ),
            'module' => 'address_book',
            'access callback' => 'address_book_access',
        ),
    );
}

/***
 * function returns label for entity
 * @param $entity
 * @param $entity_type
 * @return string
 */
function address_book_title_callback($entity, $entity_type)
{

    $title = '';
    if (isset($entity->title)) $title .= $entity->title . ' ';
    if (isset($entity->field_last_name['und'][0]['value'])) $title .= $entity->field_last_name['und'][0]['value'];
    return $title;
}

/**
 * Access callback for contact entities.
 *
 * @param $op
 * @param null $recipe
 * @param null $account
 * @return bool
 */
function address_book_access($op, $recipe = NULL, $account = NULL)
{
    return user_access('post comments');
}

function address_book_manage_page()
{
    return t('Administration page for Recipes');
}
